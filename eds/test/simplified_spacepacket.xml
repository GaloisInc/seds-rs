<?xml version="1.0" encoding="UTF-8"?>
<!--

   NASA Docket No. GSC-18,719-1, and identified as “core Flight System: Bootes”

   Copyright (c) 2020 United States Government as represented by the
   Administrator of the National Aeronautics and Space Administration.
   All Rights Reserved.

   Licensed under the Apache License, Version 2.0 (the "License"); you may
   not use this file except in compliance with the License. You may obtain
   a copy of the License at http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.

    Purpose:
      This describes objects as defined by CCSDS 133.0-B-2 Space Packet Protocol
      standard

-->
<PackageFile
  xmlns="http://www.ccsds.org/schema/sois/seds"
	xmlns:xi="http://www.w3.org/2001/XInclude"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.ccsds.org/schema/sois/seds seds.xsd">
<Package name="CCSDS" shortDescription="CCSDS Space Packet Protocol definitions">
<xi:include href="./eds/cFE/modules/core_api/eds/base_types.xml" xpointer="element(/1/1)"/>

  <!-- primary header definitions -->
   <DataTypeSet>
      <IntegerDataType name="VersionId" shortDescription="Packet version number">
        <IntegerDataEncoding sizeInBits="3" encoding="unsigned" />
        <Range>
          <MinMaxRange max="7" min="0" rangeType="inclusiveMinInclusiveMax"/>
        </Range>
      </IntegerDataType>

      <IntegerDataType name="SecHdrFlags" shortDescription="Packet type and secondary header flag">
        <LongDescription>
          This field merges two fields defined in the standard - 1 bit for a packet type (Tlm vs Cmd),
          and one bit for the presence of the secondary header.
        </LongDescription>
        <IntegerDataEncoding sizeInBits="2" encoding="unsigned" />
        <Range>
          <MinMaxRange max="3" min="0" rangeType="inclusiveMinInclusiveMax"/>
        </Range>
      </IntegerDataType>

      <IntegerDataType name="AppId" shortDescription="Application Process identifier">
        <IntegerDataEncoding sizeInBits="11" encoding="unsigned" byteOrder="bigEndian"/>
        <Range>
          <MinMaxRange max="2047" min="0" rangeType="inclusiveMinInclusiveMax"/>
        </Range>
      </IntegerDataType>

      <IntegerDataType name="SeqFlag" shortDescription="Sequence flags">
        <IntegerDataEncoding sizeInBits="2" encoding="unsigned" />
        <Range>
          <MinMaxRange max="3" min="0" rangeType="inclusiveMinInclusiveMax"/>
        </Range>
      </IntegerDataType>

      <IntegerDataType name="SeqCount" shortDescription="Packet sequence count or packet name">
        <IntegerDataEncoding sizeInBits="14" encoding="unsigned" byteOrder="bigEndian"/>
        <Range>
          <MinMaxRange max="16383" min="0" rangeType="inclusiveMinInclusiveMax"/>
        </Range>
      </IntegerDataType>

      <IntegerDataType name="LengthType" shortDescription="The length of a CCSDS Space Packet">
        <IntegerDataEncoding sizeInBits="16" encoding="unsigned" byteOrder="bigEndian"/>
        <Range>
          <MinMaxRange max="65535" min="0" rangeType="inclusiveMinInclusiveMax"/>
        </Range>
      </IntegerDataType>

      <!--
      The Real Primary Header (version 1):
         This is the proper definition of the CCSDS primary header, with each field broken out into
         its proper length rather than being BASE_TYPES/uint16.  However this will not be "drop-in" compatible
         with existing CFE/CFS application source code that expects 3 uint16 values.  However the differences
         should be addressable by changing the accessor macros in the CFE source code.
      -->
      <ContainerDataType name="BaseHdr" shortDescription="Space packet protocol header">
         <LongDescription>
            The Primary message header that is present in all CCSDS Space Protocol packets
         </LongDescription>
         <EntryList>
            <Entry name="VersionId" type="VersionId" shortDescription="CCSDS Version number" />
            <Entry name="SecHdrFlags" type="SecHdrFlags" shortDescription="Secondary Header Presence and Type Flags" />
            <Entry name="AppId" type="AppId" shortDescription="Packet identifier bits (stream ID)" />
            <Entry name="SeqFlag" type="SeqFlag" shortDescription="packet sequence bits" />
            <Entry name="Sequence" type="SeqCount" shortDescription="packet sequence bits" />
            <LengthEntry name="Length" type="LengthType" shortDescription="packet data length">
                <PolynomialCalibrator>
                    <Term coefficient="1" exponent="1" />
                    <Term coefficient="7" exponent="0" />
                </PolynomialCalibrator>
            </LengthEntry>
         </EntryList>
      </ContainerDataType>

    <!-- secondary header definitions -->
    <IntegerDataType name="PUS" shortDescription="PUS version number">
        <IntegerDataEncoding sizeInBits="4" encoding="unsigned" />
        <Range>
          <MinMaxRange max="31" min="0" rangeType="inclusiveMinInclusiveMax"/>
        </Range>
      </IntegerDataType>

    <IntegerDataType name="TimeReference" shortDescription="Spacecraft time reference status">
        <IntegerDataEncoding sizeInBits="4" encoding="unsigned" />
        <Range>
          <MinMaxRange max="31" min="0" rangeType="inclusiveMinInclusiveMax"/>
        </Range>
    </IntegerDataType>





      <ContainerDataType name="PriHdr" baseType="BaseHdr" shortDescription="Space packet protocol header version 1">
         <ConstraintSet>
           <ValueConstraint entry="VersionId" value="0" />
         </ConstraintSet>
      </ContainerDataType>

      <ContainerDataType name="SpacePacket">
         <EntryList>
            <Entry name="Hdr" type="${CCSDS_SPACEPACKET/HEADER_TYPE}" shortDescription="Primary Header" />
         </EntryList>
      </ContainerDataType>

      <ContainerDataType baseType="SpacePacket" name="CommandPacket" shortDescription="Complete Command Packet Header">
         <ConstraintSet>
           <ValueConstraint entry="Hdr.SecHdrFlags" value="3" />
         </ConstraintSet>
         <!--EntryList>
            <Entry name="Sec" type="CmdSecHdr" shortDescription="Command Secondary Header" />
         </EntryList-->
      </ContainerDataType>

      <ContainerDataType baseType="SpacePacket" name="TelemetryPacket" shortDescription="Complete Telemetry Packet Header">
         <ConstraintSet>
           <ValueConstraint entry="Hdr.SecHdrFlags" value="1" />
         </ConstraintSet>
         <!--EntryList>
            <Entry name="Sec" type="TlmSecHdr" shortDescription="Telemetry Secondary Header" />
         </EntryList-->
      </ContainerDataType>

      <ContainerDataType name="PacketContainer" shortDescription="A buffer capable of storing any Space Packet" >
         <EntryList>
            <Entry name="Data" type="SpacePacket" shortDescription="Packet Content" />
         </EntryList>
      </ContainerDataType>




   </DataTypeSet>

</Package>
</PackageFile>
